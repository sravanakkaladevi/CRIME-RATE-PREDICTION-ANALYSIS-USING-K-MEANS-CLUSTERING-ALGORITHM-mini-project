{% extends 'base.html' %}
{% load static %}
{% block content %}

<style>
/* Background + overlay */
body {
  background: url("{% static 'images/pexels-cottonbro-8369520.jpg' %}") center/cover fixed no-repeat;
  color: #fff;
}
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.88);
  backdrop-filter: blur(7px);
  z-index: -1;
}

/* Main container */
.analysis-box {
  background: rgba(0,0,0,0.7);
  border: 1px solid rgba(0,255,255,0.25);
  border-radius: 18px;
  padding: 35px;
  margin: 50px auto;
  max-width: 1250px;
  text-align: center;
  box-shadow: 0 0 25px rgba(0,255,255,0.25);
  animation: fadeIn 0.8s ease;
}

/* Title animation */
.analysis-box h2 {
  font-weight: 700;
  font-size: 2.2rem;
  background: linear-gradient(90deg, #00eaff, #ffb347, #a569bd);
  background-size: 200% auto;
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  border-right: 4px solid #fff;
  white-space: nowrap;
  overflow: hidden;
  animation: 
    shine 3s linear infinite,
    typing 2s steps(30) 1s forwards,
    pulse 2.5s infinite alternate ease-in-out;
}
@keyframes shine { to { background-position: 200% center; } }
@keyframes typing { from { width: 0; } to { width: 100%; } }
@keyframes pulse { 0% { text-shadow: 0 0 5px #00eaff; } 100% { text-shadow: 0 0 20px #00eaff; } }

.underline-glow {
  width: 100px;
  height: 3px;
  background: linear-gradient(90deg,#00eaff,transparent);
  margin: 8px auto 25px auto;
  border-radius: 10px;
}

/* Graph images */
.img-fluid {
  border-radius: 16px;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  cursor: zoom-in;
}
.img-fluid:hover {
  transform: scale(1.03);
  box-shadow: 0 0 25px rgba(0,255,255,0.5);
}

/* Table styling */
.table-container {
  background: rgba(255,255,255,0.97);
  color: #000;
  border-radius: 14px;
  padding: 20px;
  margin-top: 25px;
  overflow-x: auto;
  box-shadow: 0 0 25px rgba(0,255,255,0.3);
  animation: fadeUp 1s ease;
}
.table-container table {
  width: 100%;
  border-collapse: collapse;
  text-align: center;
}
.table-container th {
  background: linear-gradient(90deg,#00eaff,#0099cc);
  color: #000;
  font-weight: 700;
  padding: 10px;
  border-bottom: 3px solid rgba(0,0,0,0.15);
  position: sticky;
  top: 0;
  cursor: pointer;
}
.table-container td {
  padding: 8px;
  border-bottom: 1px solid #ccc;
}
.table-container tr:hover {
  background-color: rgba(0,238,255,0.07);
}

@keyframes fadeIn { from { opacity:0; transform:translateY(20px);} to { opacity:1; transform:translateY(0);} }
@keyframes fadeUp { from { opacity:0; transform:translateY(30px);} to { opacity:1; transform:translateY(0);} }
</style>

<div class="analysis-box">
  <h2>üìä Crime Analysis Dashboard</h2>
  <div class="underline-glow"></div>

  <div class="row justify-content-center">
    {% if graphs %}
      {% for name, path in graphs.items %}
      {% if path %}
      <div class="col-md-5 mb-4">
        <img src="{{ path }}" class="img-fluid shadow-lg" alt="{{ name }}" onclick="openFullscreen(this)">
        <p class="text-light mt-2">{{ name }}</p>
      </div>
      {% endif %}
      {% endfor %}
    {% else %}
      <p class="text-light mt-4">‚ö† No analysis graphs available for this dataset.</p>
    {% endif %}
  </div>

  <h4 class="text-light mt-5">üßæ Dataset Preview</h4>
  <div class="table-container" id="tableContainer">
    {{ table|safe }}
  </div>
</div>

<!-- jQuery + DataTables -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

<script>
/* Fullscreen image viewer */
function openFullscreen(img) {
  const overlay = document.createElement("div");
  overlay.style = `
    position:fixed; top:0; left:0; width:100vw; height:100vh;
    background:rgba(0,0,0,0.95); display:flex; align-items:center; 
    justify-content:center; z-index:9999; cursor:zoom-out;
  `;

  const fullImg = document.createElement("img");
  fullImg.src = img.src;
  fullImg.style = `
    max-width:95vw; max-height:95vh;
    border-radius:12px; box-shadow:0 0 25px rgba(0,255,255,0.6);
  `;

  overlay.appendChild(fullImg);
  overlay.onclick = () => overlay.remove();
  document.body.appendChild(overlay);
}

/* Datatable initialization */
$(document).ready(function () {
  const table = $('#tableContainer table');
  table.addClass('table table-bordered table-hover table-sm');
  table.DataTable({
    pageLength: 20,
    lengthChange: true,
    ordering: true,
    order: [],
    scrollX: true,
    language: { search: "üîç Search:" },
    columnDefs: [{ targets: "_all", className: "text-center align-middle" }]
  });
});
</script>

{% endblock %}
